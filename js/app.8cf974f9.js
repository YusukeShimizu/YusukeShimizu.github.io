(function(e){function t(t){for(var a,c,s=t[0],i=t[1],l=t[2],p=0,d=[];p<s.length;p++)c=s[p],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&d.push(r[c][0]),r[c]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);u&&u(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var i=n[s];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var a={},r={app:0},o=[];function c(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=a,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)c.d(n,a,function(t){return e[t]}.bind(null,a));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=i;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("div",{staticClass:"d-flex align-center"},[n("v-icon",[e._v("mdi-monitor-speaker")])],1),n("v-spacer"),n("v-btn",{attrs:{href:"https://github.com/YusukeShimizu/candy-prototype",target:"_blank",text:""}},[n("span",{staticClass:"mr-2"},[e._v("github")]),n("v-icon",[e._v("mdi-github")])],1)],1),n("v-main",[n("router-view")],1)],1)},o=[],c={name:"App"},s=c,i=n("2877"),l=n("6544"),u=n.n(l),p=n("7496"),d=n("40dc"),f=n("8336"),m=n("132d"),v=n("f6c4"),h=n("2fa4"),b=Object(i["a"])(s,r,o,!1,null,null,null),_=b.exports;u()(b,{VApp:p["a"],VAppBar:d["a"],VBtn:f["a"],VIcon:m["a"],VMain:v["a"],VSpacer:h["a"]});var g=n("f309");a["a"].use(g["a"]);var y=new g["a"]({}),w=n("0ff2"),E=(n("45fc"),n("8c4f")),V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("User",{ref:"User",on:{"make-call":e.makeCall}}),n("Users",{on:{"make-call":e.makeCall}}),n("Record"),n("Logout")],1)},S=[],I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{dense:""}},[n("v-col",{staticClass:"my-10",attrs:{cols:"12"}},[n("div",{staticClass:"text-center"},[n("v-btn",{staticClass:"mx-2",attrs:{fab:"",dark:"",color:"indigo"},on:{click:e.logout}},[n("v-icon",{attrs:{dark:""}},[e._v(" mdi-logout ")])],1)],1)])],1)],1)},C=[],A=n("260b"),P={name:"Logout",methods:{logout:function(){A["a"].auth().signOut()}}},U=P,O=n("62ad"),k=n("a523"),x=n("0fd9"),j=Object(i["a"])(U,I,C,!1,null,null,null),D=j.exports;u()(j,{VBtn:f["a"],VCol:O["a"],VContainer:k["a"],VIcon:m["a"],VRow:x["a"]});var L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{staticClass:"text-center"},[n("v-col",{staticClass:"my-10",attrs:{cols:"12"}},[n("h1",{staticClass:"display-2 font-weight-bold mb-3"},[e._v("Welcome👍")]),n("v-row",{staticClass:"my-2",attrs:{justify:"center"}},[n("p",[e._v("Your peer id: "+e._s(e.peer.id))])]),n("v-row",{staticClass:"my-2",attrs:{justify:"center"}},[n("p",[e._v("peer status: "+e._s(e.peerStatus))])]),n("v-row",{staticClass:"my-2",attrs:{justify:"center"}},[n("p",[e._v("call status: "+e._s(e.callStatus))])])],1)],1),n("div",[n("audio",{attrs:{autoplay:""},domProps:{srcObject:e.stream}})])],1)},R=[],T=(n("96cf"),n("1da1"));n("e71f"),n("ea7b");A["a"].initializeApp({apiKey:"AIzaSyC3iybSesgLYQLeT5q8CzFtGbzPr9obTEU",authDomain:"candy-prototype.firebaseapp.com",projectId:"candy-prototype",storageBucket:"candy-prototype.appspot.com",messagingSenderId:Object({NODE_ENV:"production",VUE_APP_SKYWAY_APIKEY:"4fecb63f-bd91-4f41-8c43-1b9a0f6a96fe",VUE_APP_APIKEY:"AIzaSyC3iybSesgLYQLeT5q8CzFtGbzPr9obTEU",VUE_APP_AUTH_DOMAIN:"candy-prototype.firebaseapp.com",VUE_APP_PROJECT_ID:"candy-prototype",VUE_APP_STORAGE_BUCKET:"candy-prototype.appspot.com",VUE_APP_MESSAGING_SENDER_ID:"490569710091",VUE_APP_APP_ID:"1:490569710091:web:0b3434640eb2775d41250e",VUE_APP_MEASUREMENT_ID:"G-ZT4EKBQ75V",BASE_URL:"/"}).VUE_APP_MESSAGE_SENDER_ID,appId:"1:490569710091:web:0b3434640eb2775d41250e",measurementId:"G-ZT4EKBQ75V"}),"localhost"===location.hostname&&(A["a"].firestore().useEmulator("localhost",8085),A["a"].auth().useEmulator("http://localhost:9099")),A["a"].firestore.setLogLevel("debug");var M=A["a"].firestore(),$=A["a"].firestore,B=($.Timestamp,$.GeoPoint,n("0b69")),G=n.n(B),N={name:"User",data:function(){return{user:null,peer:G.a,call:G.a.call,peerStatus:"beforeOpen",callStatus:"close",localStream:{},stream:{},firebase:[]}},mounted:function(){var e=Object(T["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return A["a"].auth().onAuthStateChanged((function(e){e?t.setUser(e):t.close()})),e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 3:this.localStream=e.sent,window.addEventListener("beforeunload",this.close);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),watch:{user:function(e){var t=this;if(e){var n=new G.a({key:"4fecb63f-bd91-4f41-8c43-1b9a0f6a96fe",debug:3});n.on("open",(function(){t.peer=n,M.collection("users").doc(e.uid).set({name:e.displayName,createdAt:A["a"].firestore.FieldValue.serverTimestamp(),peerID:n.id,id:e.uid}).then((function(e){console.log("Document written with ID: ",e)})).catch((function(e){console.error("Error adding document: ",e)})),t.peerStatus="open"})),n.on("call",(function(e){e.answer(t.localStream),t.connect(e)})),n.on("disconnected",(function(e){t.peerStatus="disconnected",alert(e+"との接続が切れました")})),n.on("error",(function(e){t.peerStatus="error",alert(e.message)})),n.on("close",(function(){t.peerStatus="close",alert("通信が切断しました。")}))}}},methods:{setUser:function(e){e&&(M.collection("users").doc(e.uid).set({name:e.displayName,createdAt:A["a"].firestore.FieldValue.serverTimestamp()}).then((function(e){console.log("Document written with ID: ",e)})).catch((function(e){console.error("Error adding document: ",e)})),this.user=e)},makeCall:function(e){var t=this.peer.call(e,this.localStream);this.connect(t)},connect:function(){var e=Object(T["a"])(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.on("close",(function(){n.callStatus="close",alert("通信が切断しました。")})),t.on("stream",(function(e){n.stream=e,n.callStatus="connect",n.stream.play()}));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),close:function(){this.peer.destroy(),M.collection("users").doc(this.user.uid).update({peerID:""}).then((function(e){console.log("Document written with ID: ",e)})).catch((function(e){console.error("Error adding document: ",e)}))}}},z=N,Y=Object(i["a"])(z,L,R,!1,null,null,null),K=Y.exports;u()(Y,{VCol:O["a"],VContainer:k["a"],VRow:x["a"]});var F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{dense:""}},e._l(e.callableUsers,(function(t,a){return n("v-col",{key:a,attrs:{cols:"12"}},[n("v-card",{staticClass:"mx-auto",attrs:{"max-width":"400"}},[n("v-list-item",[n("v-list-item-icon",[n("v-icon",[e._v("mdi-emoticon-outline")])],1),n("v-list-item-subtitle",[e._v(e._s(t.name))])],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{icon:""},on:{click:function(n){return e.call(t.peerID)}}},[n("v-icon",[e._v("mdi-phone")])],1),n("v-btn",{attrs:{icon:""},on:{click:function(n){return e.rec(t.peerID)}}},[n("v-icon",[e._v("mdi-play")])],1)],1)],1)],1)})),1)},q=[],Q=(n("4de4"),{name:"Users",data:function(){return{users:[]}},computed:{callableUsers:function(){return this.users.filter((function(e){return""!=e.peerID}))}},methods:{call:function(e){alert("calling to "+e),this.$emit("make-call",e)},rec:function(e){alert("Listen for "+e+". Implement me!")}},firestore:function(){return{users:M.collection("users").where("id","!=",A["a"].auth().currentUser.uid)}}}),J=Q,W=n("b0af"),Z=n("99d9"),H=n("da13"),X=n("34c3"),ee=n("5d23"),te=Object(i["a"])(J,F,q,!1,null,null,null),ne=te.exports;u()(te,{VBtn:f["a"],VCard:W["a"],VCardActions:Z["a"],VCol:O["a"],VIcon:m["a"],VListItem:H["a"],VListItemIcon:X["a"],VListItemSubtitle:ee["a"],VRow:x["a"],VSpacer:h["a"]});var ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{dense:""}},[n("v-col",{staticClass:"my-10",attrs:{cols:"12"}},[n("div",{staticClass:"text-center"},[n("v-btn",{staticClass:"mx-2",attrs:{fab:"",dark:"",color:"indigo"},on:{click:e.addVoice}},[n("v-icon",{attrs:{dark:""}},[e._v(" mdi-plus ")])],1)],1)])],1)],1)},re=[],oe={name:"Record",methods:{addVoice:function(){alert("Start recording. implement me!")}}},ce=oe,se=Object(i["a"])(ce,ae,re,!1,null,null,null),ie=se.exports;u()(se,{VBtn:f["a"],VCol:O["a"],VContainer:k["a"],VIcon:m["a"],VRow:x["a"]});var le={name:"Main",components:{Logout:D,User:K,Users:ne,Record:ie},methods:{makeCall:function(e){this.$refs.User.makeCall(e)}}},ue=le,pe=Object(i["a"])(ue,V,S,!1,null,null,null),de=pe.exports,fe=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},me=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"firebaseui-auth-container"}})])}],ve=n("2398"),he=(n("c9b9"),{name:"Login",mounted:function(){this.ui=ve["a"].AuthUI.getInstance()||new ve["a"].AuthUI(A["a"].auth()),this.ui.start("#firebaseui-auth-container",{signInFlow:"redirect",signInSuccessUrl:"/",signInOptions:[A["a"].auth.GoogleAuthProvider.PROVIDER_ID]})}}),be=he,_e=Object(i["a"])(be,fe,me,!1,null,null,null),ge=_e.exports;a["a"].use(E["a"]);var ye=[{path:"/",name:"Main",meta:{requiresAuth:!0},component:de},{path:"/Login",name:"Login",component:ge}],we=new E["a"]({base:"/",routes:ye});we.beforeEach((function(e,t,n){var a=e.matched.some((function(e){return e.meta.requiresAuth}));a?A["a"].auth().onAuthStateChanged((function(e){e?n():n({name:"Login"})})):n()}));var Ee=we;a["a"].use(w["a"]),a["a"].config.productionTip=!1,new a["a"]({vuetify:y,router:Ee,render:function(e){return e(_)}}).$mount("#app")}});
//# sourceMappingURL=app.8cf974f9.js.map